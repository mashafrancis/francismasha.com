import { readFile } from "node:fs/promises";
import { join } from "node:path";

import { ImageResponse } from "next/og";

export async function GET(request: Request) {
  const { searchParams } = new URL(request.url);

  const title = searchParams.get("title");

  const robotoCondensedMedium = await readFile(
    join(process.cwd(), "src/assets/fonts/RobotoCondensed-Medium.ttf")
  );

  return new ImageResponse(
    (
      <div tw="w-full h-full flex items-center justify-center text-white bg-black p-16">
        <div tw="absolute flex inset-y-0 w-px border border-zinc-800 left-16" />
        <div tw="absolute flex inset-y-0 w-px border border-zinc-800 right-16" />
        <div tw="absolute flex inset-x-0 h-px border border-zinc-800 top-16" />
        <div tw="absolute flex inset-x-0 h-px border border-zinc-800 bottom-16" />

        <div tw="absolute flex bottom-16 right-16">
          <svg
            width={160}
            height={80}
            viewBox="0 0 768 384"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M408 0L540.94 47.348C587.687 62.8638 587.687 129.137 540.94 144.653L408 192V160.013L531.483 116.034C550.732 109.645 550.732 82.3559 531.483 75.967L427.553 38.2476L360 192L227.06 144.653C180.313 129.137 180.313 62.8638 227.06 47.348L360 0V31.987L236.517 75.967C217.268 82.3559 217.268 109.645 236.517 116.034L340.447 153.752L408 0Z"
              fill="currentColor"
            />
            <path
              d="M37.3132 384C29.8077 384 23.2136 382.606 17.5308 379.819C11.9552 376.925 7.61276 372.905 4.50332 367.759C1.50111 362.506 0 356.342 0 349.266V298.131C0 290.948 1.50111 284.784 4.50332 279.638C7.61276 274.492 11.9552 270.526 17.5308 267.739C23.2136 264.844 29.8077 263.397 37.3132 263.397C44.926 263.397 51.4666 264.844 56.9349 267.739C62.5104 270.526 66.8529 274.492 69.9623 279.638C73.0718 284.784 74.6265 290.948 74.6265 298.131H54.3615C54.3615 292.556 52.8604 288.322 49.8582 285.427C46.9632 282.533 42.7816 281.085 37.3132 281.085C31.8449 281.085 27.6097 282.533 24.6074 285.427C21.6052 288.322 20.1041 292.503 20.1041 297.97V349.266C20.1041 354.734 21.6052 358.968 24.6074 361.97C27.6097 364.864 31.8449 366.312 37.3132 366.312C42.7816 366.312 46.9632 364.864 49.8582 361.97C52.8604 358.968 54.3615 354.734 54.3615 349.266H74.6265C74.6265 356.235 73.0718 362.345 69.9623 367.598C66.8529 372.851 62.5104 376.925 56.9349 379.819C51.4666 382.606 44.926 384 37.3132 384Z"
              fill="currentColor"
            />
            <path
              d="M99.3521 382.392V265.005H119.456V293.95L118.974 310.834H124.442L118.974 315.497C118.974 308.208 121.064 302.526 125.246 298.452C129.535 294.379 135.379 292.342 142.777 292.342C151.462 292.342 158.378 295.236 163.524 301.025C168.778 306.814 171.405 314.586 171.405 324.342V382.392H151.301V326.432C151.301 321.072 149.907 316.945 147.119 314.05C144.332 311.156 140.418 309.709 135.379 309.709C130.446 309.709 126.533 311.209 123.638 314.211C120.85 317.213 119.456 321.501 119.456 327.075V382.392H99.3521Z"
              fill="currentColor"
            />
            <path
              d="M223.955 384C214.841 384 207.657 381.588 202.403 376.764C197.149 371.94 194.522 365.454 194.522 357.307C194.522 348.623 197.417 341.923 203.207 337.206C208.997 332.489 217.2 330.131 227.815 330.131H249.849V322.573C249.849 318.285 248.455 314.961 245.667 312.603C242.88 310.137 239.073 308.905 234.248 308.905C229.852 308.905 226.207 309.869 223.312 311.799C220.417 313.729 218.701 316.355 218.165 319.678H198.543C199.508 311.317 203.261 304.67 209.802 299.739C216.342 294.807 224.705 292.342 234.892 292.342C245.721 292.342 254.245 295.075 260.464 300.543C266.79 305.903 269.953 313.193 269.953 322.412V382.392H250.492V366.955H247.276L250.492 362.613C250.492 369.152 248.08 374.352 243.255 378.211C238.43 382.07 231.997 384 223.955 384ZM230.549 368.884C236.232 368.884 240.842 367.437 244.381 364.543C248.026 361.648 249.849 357.896 249.849 353.286V342.513H228.137C224.062 342.513 220.792 343.692 218.326 346.05C215.86 348.409 214.627 351.518 214.627 355.377C214.627 359.558 216.02 362.881 218.808 365.347C221.703 367.705 225.617 368.884 230.549 368.884Z"
              fill="currentColor"
            />
            <path
              d="M296.448 382.392V293.95H316.069V310.834H321.538L316.069 315.497C316.069 308.208 318.16 302.526 322.342 298.452C326.631 294.379 332.474 292.342 339.873 292.342C348.558 292.342 355.474 295.236 360.62 301.025C365.874 306.814 368.501 314.586 368.501 324.342V382.392H348.397V326.432C348.397 321.072 347.003 316.945 344.215 314.05C341.427 311.156 337.514 309.709 332.474 309.709C327.542 309.709 323.629 311.209 320.734 314.211C317.946 317.213 316.552 321.501 316.552 327.075V382.392H296.448Z"
              fill="currentColor"
            />
            <path
              d="M394.996 382.392V265.005H415.1V293.95L414.617 310.834H420.086L414.617 315.497C414.617 308.208 416.708 302.526 420.89 298.452C425.179 294.379 431.022 292.342 438.421 292.342C447.106 292.342 454.021 295.236 459.168 301.025C464.422 306.814 467.049 314.586 467.049 324.342V382.392H446.945V326.432C446.945 321.072 445.551 316.945 442.763 314.05C439.975 311.156 436.062 309.709 431.022 309.709C426.09 309.709 422.176 311.209 419.281 314.211C416.494 317.213 415.1 321.501 415.1 327.075V382.392H394.996Z"
              fill="currentColor"
            />
            <path
              d="M493.222 382.392V265.005H528.123C536.057 265.005 542.919 266.506 548.709 269.508C554.606 272.509 559.163 276.744 562.38 282.211C565.597 287.678 567.205 294.164 567.205 301.668V345.568C567.205 352.965 565.597 359.451 562.38 365.025C559.163 370.492 554.606 374.781 548.709 377.889C542.919 380.891 536.057 382.392 528.123 382.392H493.222ZM513.326 363.899H528.123C533.913 363.899 538.523 362.291 541.954 359.075C545.385 355.752 547.101 351.25 547.101 345.568V301.668C547.101 296.094 545.385 291.698 541.954 288.482C538.523 285.159 533.913 283.497 528.123 283.497H513.326V363.899Z"
              fill="currentColor"
            />
            <path
              d="M618.146 384C609.032 384 601.849 381.588 596.595 376.764C591.341 371.94 588.714 365.454 588.714 357.307C588.714 348.623 591.609 341.923 597.399 337.206C603.189 332.489 611.391 330.131 622.006 330.131H644.04V322.573C644.04 318.285 642.647 314.961 639.859 312.603C637.071 310.137 633.265 308.905 628.44 308.905C624.044 308.905 620.398 309.869 617.503 311.799C614.608 313.729 612.892 316.355 612.356 319.678H592.735C593.7 311.317 597.453 304.67 603.993 299.739C610.534 294.807 618.897 292.342 629.083 292.342C639.912 292.342 648.437 295.075 654.655 300.543C660.982 305.903 664.145 313.193 664.145 322.412V382.392H644.684V366.955H641.467L644.684 362.613C644.684 369.152 642.271 374.352 637.446 378.211C632.621 382.07 626.188 384 618.146 384ZM624.741 368.884C630.423 368.884 635.034 367.437 638.572 364.543C642.218 361.648 644.04 357.896 644.04 353.286V342.513H622.328C618.254 342.513 614.983 343.692 612.517 346.05C610.051 348.409 608.818 351.518 608.818 355.377C608.818 359.558 610.212 362.881 613 365.347C615.895 367.705 619.808 368.884 624.741 368.884Z"
              fill="currentColor"
            />
            <path
              d="M690.479 382.392V364.06H721.358V312.121H694.499V293.95H740.658V364.06H768V382.392H690.479ZM729.4 279.156C725.326 279.156 722.109 278.137 719.75 276.101C717.391 273.956 716.212 271.116 716.212 267.578C716.212 264.04 717.391 261.253 719.75 259.216C722.109 257.072 725.326 256 729.4 256C733.475 256 736.691 257.072 739.05 259.216C741.409 261.253 742.588 264.04 742.588 267.578C742.588 271.116 741.409 273.956 739.05 276.101C736.691 278.137 733.475 279.156 729.4 279.156Z"
              fill="currentColor"
            />
          </svg>
        </div>

        <h1
          tw="text-center font-medium"
          style={{
            fontFamily: "RobotoCondensed",
            fontSize: 64,
          }}
        >
          {title}
        </h1>
      </div>
    ),
    {
      width: 1200,
      height: 630,
      fonts: [
        {
          name: "RobotoCondensed",
          data: robotoCondensedMedium,
          weight: 500,
        },
      ],
    }
  );
}
